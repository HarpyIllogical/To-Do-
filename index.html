<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskFlow - Modern Task Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#6366f1',
                        secondary: '#818cf8',
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444',
                        info: '#0ea5e9',
                        dark: '#1e293b'
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-in',
                        'slide-in': 'slideIn 0.3s ease-out'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: 0 },
                            '100%': { opacity: 1 }
                        },
                        slideIn: {
                            '0%': { transform: 'translateY(20px)', opacity: 0 },
                            '100%': { transform: 'translateY(0)', opacity: 1 }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        body {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
        }
        .task-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .task-card.now {
            border-left-color: #10b981;
        }
        .task-card.almost-due {
            border-left-color: #f59e0b;
        }
        .task-card.overdue {
            border-left-color: #ef4444;
        }
        .current-task {
            background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(99, 102, 241, 0); }
            100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
        }
        .confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
        .countdown-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
        }
        .done-task {
            text-decoration: line-through;
            opacity: 0.7;
        }
        .task-status {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .status-upcoming {
            background-color: #dbeafe;
            color: #3b82f6;
        }
        .status-now {
            background-color: #dcfce7;
            color: #16a34a;
        }
        .status-almost-due {
            background-color: #fef3c7;
            color: #d97706;
        }
        .status-overdue {
            background-color: #fee2e2;
            color: #dc2626;
        }
        .time-display {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .add-task-btn {
            transition: all 0.3s ease;
        }
        .add-task-btn:hover {
            transform: scale(1.05);
        }
        .edit-modal {
            animation: slideIn 0.3s ease-out;
        }
    </style>
</head>
<body class="min-h-screen py-8 px-4">
    <!-- Confetti Canvas -->
    <canvas id="confetti-canvas" class="confetti-canvas"></canvas>
    
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">TaskFlow</h1>
            <p class="text-gray-600">Modern Task Management with Real-Time Tracking</p>
            
            <!-- Current Time Display -->
            <div class="time-display inline-block px-6 py-3 mt-4">
                <div id="current-time" class="text-3xl font-mono font-bold tracking-wider">00:00:00</div>
                <div id="current-date" class="text-gray-300 mt-1 text-sm">Saturday, January 1, 2023</div>
            </div>
        </header>
        
        <!-- Current Task Section -->
        <section class="mb-8">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Current Task</h2>
            <div id="current-task-container" class="current-task rounded-xl p-5 shadow-lg border border-blue-200">
                <div id="no-current-task" class="text-center py-6">
                    <i class="fas fa-coffee text-3xl text-gray-400 mb-3"></i>
                    <p class="text-gray-600">No current task. Enjoy your free time!</p>
                </div>
                <!-- Current task will be inserted here dynamically -->
            </div>
        </section>
        
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Task List Section -->
            <main class="lg:w-2/3">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-gray-700">Your Tasks</h2>
                    <div class="flex space-x-2">
                        <button id="today-toggle" class="px-3 py-1 bg-primary text-white rounded-lg text-sm font-medium">Today</button>
                        <button id="upcoming-toggle" class="px-3 py-1 bg-gray-200 text-gray-700 rounded-lg text-sm font-medium">Upcoming</button>
                    </div>
                </div>
                
                <div id="tasks-container" class="space-y-4">
                    <!-- Tasks will be added here dynamically -->
                    <div class="text-center py-10">
                        <i class="fas fa-tasks text-4xl text-gray-300 mb-3"></i>
                        <p class="text-gray-500">No tasks yet. Add some tasks to get started!</p>
                    </div>
                </div>
                
                <!-- Add Task Button -->
                <button id="add-task-btn" class="add-task-btn mt-6 w-full py-3 bg-primary hover:bg-secondary text-white rounded-lg font-medium flex items-center justify-center">
                    <i class="fas fa-plus mr-2"></i> Add New Task
                </button>
                
                <!-- Mass Task Input -->
                <div class="mt-8">
                    <h3 class="text-lg font-medium text-gray-700 mb-3">Add Multiple Tasks</h3>
                    <textarea id="mass-task-input" rows="5" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Paste tasks in format:
08/11/2025
6h30–8h: Toán (đ)  
8h–8h30: Toán (ch)  
8h30–9h20: Lý (đ)"></textarea>
                    <button id="process-mass-tasks" class="mt-3 py-2 px-4 bg-info text-white rounded-lg font-medium">Add Tasks</button>
                </div>
            </main>
            
            <!-- Stats & Info Sidebar -->
            <aside class="lg:w-1/3">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4">Today's Summary</h3>
                    
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
                                    <i class="fas fa-tasks text-blue-500"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm font-medium text-gray-600">Total Tasks</p>
                                    <p id="total-tasks" class="font-bold text-gray-800">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center">
                                    <i class="fas fa-check-circle text-green-500"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm font-medium text-gray-600">Completed</p>
                                    <p id="completed-tasks" class="font-bold text-gray-800">0</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-10 h-10 rounded-full bg-yellow-100 flex items-center justify-center">
                                    <i class="fas fa-exclamation-triangle text-yellow-500"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-sm font-medium text-gray-600">Pending</p>
                                    <p id="pending-tasks" class="font-bold text-gray-800">0</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 pt-4 border-t border-gray-200">
                        <h4 class="text-md font-medium text-gray-700 mb-3">Task Status Guide</h4>
                        <div class="space-y-2">
                            <div class="flex items-center">
                                <span class="status-upcoming task-status">Upcoming</span>
                                <span class="ml-2 text-sm text-gray-600">Task is scheduled for later</span>
                            </div>
                            <div class="flex items-center">
                                <span class="status-now task-status">Now</span>
                                <span class="ml-2 text-sm text-gray-600">Task is currently active</span>
                            </div>
                            <div class="flex items-center">
                                <span class="status-almost-due task-status">Almost Due</span>
                                <span class="ml-2 text-sm text-gray-600">Task starts within 10 minutes</span>
                            </div>
                            <div class="flex items-center">
                                <span class="status-overdue task-status">Overdue</span>
                                <span class="ml-2 text-sm text-gray-600">Task end time has passed</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <h4 class="text-md font-medium text-gray-700 mb-3">Quick Tips</h4>
                        <ul class="text-sm text-gray-600 space-y-2">
                            <li class="flex items-start">
                                <i class="fas fa-lightbulb text-yellow-400 mt-1 mr-2"></i>
                                <span>Click on a task to edit or delete it</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-lightbulb text-yellow-400 mt-1 mr-2"></i>
                                <span>Use the mass task input to quickly add multiple tasks</span>
                            </li>
                            <li class="flex items-start">
                                <i class="fas fa-lightbulb text-yellow-400 mt-1 mr-2"></i>
                                <span>Check off tasks to trigger celebration effects</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </aside>
        </div>
    </div>
    
    <!-- Add/Edit Task Modal -->
    <div id="task-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="edit-modal bg-white rounded-xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modal-title" class="text-xl font-bold text-gray-800">Add New Task</h3>
                <button id="close-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="task-form" class="space-y-4">
                <input type="hidden" id="task-id">
                
                <div>
                    <label class="block text-gray-700 mb-1">Task Title</label>
                    <input type="text" id="task-title" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 mb-1">Start Time</label>
                        <input type="time" id="task-start" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 mb-1">End Time</label>
                        <input type="time" id="task-end" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    </div>
                </div>
                
                <div class="pt-4 flex justify-end space-x-3">
                    <button type="button" id="cancel-modal" class="px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg font-medium">Save Task</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // Task Management
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let editingTaskId = null;
        
        // DOM Elements
        const tasksContainer = document.getElementById('tasks-container');
        const currentTimeElement = document.getElementById('current-time');
        const currentDateElement = document.getElementById('current-date');
        const currentTaskContainer = document.getElementById('current-task-container');
        const noCurrentTaskElement = document.getElementById('no-current-task');
        const addTaskBtn = document.getElementById('add-task-btn');
        const taskModal = document.getElementById('task-modal');
        const closeModal = document.getElementById('close-modal');
        const cancelModal = document.getElementById('cancel-modal');
        const taskForm = document.getElementById('task-form');
        const modalTitle = document.getElementById('modal-title');
        const taskTitleInput = document.getElementById('task-title');
        const taskStartInput = document.getElementById('task-start');
        const taskEndInput = document.getElementById('task-end');
        const taskIdInput = document.getElementById('task-id');
        const massTaskInput = document.getElementById('mass-task-input');
        const processMassTasksBtn = document.getElementById('process-mass-tasks');
        const todayToggle = document.getElementById('today-toggle');
        const upcomingToggle = document.getElementById('upcoming-toggle');
        const totalTasksElement = document.getElementById('total-tasks');
        const completedTasksElement = document.getElementById('completed-tasks');
        const pendingTasksElement = document.getElementById('pending-tasks');
        
        // Initialize the app
        function init() {
            renderTasks();
            updateClock();
            setInterval(updateClock, 1000);
            updateStats();
            
            // Set up event listeners
            addTaskBtn.addEventListener('click', () => openTaskModal());
            closeModal.addEventListener('click', () => closeTaskModal());
            cancelModal.addEventListener('click', () => closeTaskModal());
            taskForm.addEventListener('submit', handleTaskFormSubmit);
            processMassTasksBtn.addEventListener('click', processMassTasks);
            todayToggle.addEventListener('click', () => setView('today'));
            upcomingToggle.addEventListener('click', () => setView('upcoming'));
            
            // Set default view
            setView('today');
        }
        
        // Update clock and date
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', {hour12: false});
            const dateString = now.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            currentTimeElement.textContent = timeString;
            currentDateElement.textContent = dateString;
            
            // Update task statuses and current task
            updateTaskStatuses();
            updateCurrentTask();
            updateStats();
        }
        
        // Set view mode
        function setView(mode) {
            if (mode === 'today') {
                todayToggle.classList.remove('bg-gray-200', 'text-gray-700');
                todayToggle.classList.add('bg-primary', 'text-white');
                upcomingToggle.classList.remove('bg-primary', 'text-white');
                upcomingToggle.classList.add('bg-gray-200', 'text-gray-700');
            } else {
                upcomingToggle.classList.remove('bg-gray-200', 'text-gray-700');
                upcomingToggle.classList.add('bg-primary', 'text-white');
                todayToggle.classList.remove('bg-primary', 'text-white');
                todayToggle.classList.add('bg-gray-200', 'text-gray-700');
            }
            renderTasks();
        }
        
        // Render tasks to the DOM
        function renderTasks() {
            if (tasks.length === 0) {
                tasksContainer.innerHTML = `
                    <div class="text-center py-10">
                        <i class="fas fa-tasks text-4xl text-gray-300 mb-3"></i>
                        <p class="text-gray-500">No tasks yet. Add some tasks to get started!</p>
                    </div>
                `;
                return;
            }
            
            // Filter tasks based on view mode
            const isTodayView = todayToggle.classList.contains('bg-primary');
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            
            const filteredTasks = isTodayView 
                ? tasks.filter(task => {
                    const taskDate = new Date(task.startTime);
                    return taskDate >= today && taskDate < new Date(today.getTime() + 24 * 60 * 60 * 1000);
                })
                : tasks;
            
            // Sort tasks by start time
            filteredTasks.sort((a, b) => new Date(a.startTime) - new Date(b.startTime));
            
            tasksContainer.innerHTML = '';
            
            filteredTasks.forEach(task => {
                const taskElement = createTaskElement(task);
                tasksContainer.appendChild(taskElement);
            });
        }
        
        // Create a task element
        function createTaskElement(task) {
            const taskDate = new Date(task.startTime);
            const startTime = formatTime(taskDate);
            const endTime = formatTime(new Date(task.endTime));
            
            const now = new Date();
            const startDate = new Date(task.startTime);
            const endDate = new Date(task.endTime);
            
            // Calculate time difference for countdown
            let timeDiff = '';
            let statusClass = '';
            
            if (task.done) {
                statusClass = 'status-upcoming';
                timeDiff = 'Completed';
            } else if (now < startDate) {
                const diffMs = startDate - now;
                const diffMins = Math.floor(diffMs / 60000);
                
                if (diffMins <= 10) {
                    statusClass = 'status-almost-due';
                } else {
                    statusClass = 'status-upcoming';
                }
                
                const diffHours = Math.floor(diffMins / 60);
                const remainingMins = diffMins % 60;
                
                timeDiff = `Starts in ${diffHours > 0 ? diffHours + 'h ' : ''}${remainingMins}m`;
            } else if (now >= startDate && now <= endDate) {
                statusClass = 'status-now';
                const diffMs = endDate - now;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMins / 60);
                const remainingMins = diffMins % 60;
                
                timeDiff = `${diffHours > 0 ? diffHours + 'h ' : ''}${remainingMins}m left`;
            } else {
                statusClass = 'status-overdue';
                timeDiff = 'Overdue';
            }
            
            const taskElement = document.createElement('div');
            taskElement.className = `task-card bg-white rounded-xl shadow p-5 relative overflow-hidden animation-fade-in ${task.done ? 'opacity-70' : ''}`;
            taskElement.dataset.id = task.id;
            
            if (statusClass === 'status-now') taskElement.classList.add('now');
            if (statusClass === 'status-almost-due') taskElement.classList.add('almost-due');
            if (statusClass === 'status-overdue') taskElement.classList.add('overdue');
            
            taskElement.innerHTML = `
                <div class="flex items-start">
                    <div class="mr-3 mt-1">
                        <input type="checkbox" ${task.done ? 'checked' : ''} class="task-checkbox w-5 h-5 rounded-full border-2 border-gray-300 focus:ring-0 focus:ring-offset-0 text-primary">
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center justify-between">
                            <h3 class="font-semibold text-gray-800 ${task.done ? 'done-task' : ''}">${task.title}</h3>
                            <span class="${statusClass} task-status">${task.done ? 'Completed' : statusClass.split('-')[1]}</span>
                        </div>
                        <div class="mt-2 flex flex-wrap items-center gap-2">
                            <span class="text-sm text-gray-600">
                                <i class="far fa-clock mr-1"></i> ${startTime} - ${endTime}
                            </span>
                            <span class="countdown-badge bg-gray-100 text-gray-800 text-xs font-medium">
                                ${timeDiff}
                            </span>
                        </div>
                    </div>
                </div>
                <div class="mt-4 flex justify-end space-x-2">
                    <button class="edit-task-btn px-3 py-1 bg-gray-100 text-gray-700 rounded-lg text-sm hover:bg-gray-200">
                        <i class="fas fa-edit mr-1"></i> Edit
                    </button>
                    <button class="delete-task-btn px-3 py-1 bg-red-100 text-red-700 rounded-lg text-sm hover:bg-red-200">
                        <i class="fas fa-trash-alt mr-1"></i> Delete
                    </button>
                </div>
            `;
            
            // Add event listeners to the buttons
            const checkbox = taskElement.querySelector('.task-checkbox');
            checkbox.addEventListener('change', () => toggleTaskDone(task.id));
            
            const editBtn = taskElement.querySelector('.edit-task-btn');
            editBtn.addEventListener('click', () => openTaskModal(task.id));
            
            const deleteBtn = taskElement.querySelector('.delete-task-btn');
            deleteBtn.addEventListener('click', () => deleteTask(task.id));
            
            return taskElement;
        }
        
        // Format time as HH:MM
        function formatTime(date) {
            return date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', hour12: false});
        }
        
        // Update task statuses
        function updateTaskStatuses() {
            tasks.forEach(task => {
                const taskElement = document.querySelector(`.task-card[data-id="${task.id}"]`);
                if (taskElement) {
                    const newElement = createTaskElement(task);
                    taskElement.replaceWith(newElement);
                }
            });
        }
        
        // Update the current task display
        function updateCurrentTask() {
            const now = new Date();
            const soon = new Date(now.getTime() + 10 * 60000); // 10 minutes from now
            
            // Find tasks that are happening now or starting within 10 minutes
            const currentTasks = tasks.filter(task => {
                if (task.done) return false;
                
                const startTime = new Date(task.startTime);
                const endTime = new Date(task.endTime);
                
                return (now >= startTime && now <= endTime) || 
                       (startTime >= now && startTime <= soon);
            });
            
            // Sort by start time (soonest first)
            currentTasks.sort((a, b) => new Date(a.startTime) - new Date(b.startTime));
            
            // Clear current task container
            currentTaskContainer.innerHTML = '';
            
            if (currentTasks.length === 0) {
                currentTaskContainer.appendChild(noCurrentTaskElement);
                return;
            }
            
            const currentTask = currentTasks[0];
            const startTime = formatTime(new Date(currentTask.startTime));
            const endTime = formatTime(new Date(currentTask.endTime));
            
            const taskElement = document.createElement('div');
            taskElement.className = 'current-task-item p-4';
            taskElement.innerHTML = `
                <div class="flex items-center">
                    <div class="mr-4">
                        <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
                            <i class="fas fa-star text-blue-500 text-xl"></i>
                        </div>
                    </div>
                    <div>
                        <h3 class="font-bold text-xl text-gray-800">${currentTask.title}</h3>
                        <div class="mt-2 flex items-center">
                            <span class="bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-medium">
                                <i class="far fa-clock mr-1"></i> ${startTime} - ${endTime}
                            </span>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <div class="relative pt-1">
                        <div class="flex mb-2 items-center justify-between">
                            <div>
                                <span class="text-xs font-semibold inline-block text-blue-600">
                                    Progress
                                </span>
                            </div>
                            <div class="text-right">
                                <span class="text-xs font-semibold inline-block text-blue-600">
                                    ${getTaskProgress(currentTask)}%
                                </span>
                            </div>
                        </div>
                        <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-blue-200">
                            <div style="width:${getTaskProgress(currentTask)}%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500"></div>
                        </div>
                    </div>
                </div>
            `;
            
            currentTaskContainer.appendChild(taskElement);
        }
        
        // Calculate task progress percentage
        function getTaskProgress(task) {
            const now = new Date();
            const startTime = new Date(task.startTime).getTime();
            const endTime = new Date(task.endTime).getTime();
            
            if (now < startTime) return 0;
            if (now > endTime) return 100;
            
            const totalDuration = endTime - startTime;
            const elapsed = now.getTime() - startTime;
            return Math.min(100, Math.round((elapsed / totalDuration) * 100));
        }
        
        // Toggle task done status
        function toggleTaskDone(id) {
            const taskIndex = tasks.findIndex(task => task.id === id);
            if (taskIndex !== -1) {
                tasks[taskIndex].done = !tasks[taskIndex].done;
                
                if (tasks[taskIndex].done) {
                    triggerConfetti();
                }
                
                saveTasks();
                renderTasks();
                updateCurrentTask();
                updateStats();
            }
        }
        
        // Delete a task
        function deleteTask(id) {
            if (confirm('Are you sure you want to delete this task?')) {
                tasks = tasks.filter(task => task.id !== id);
                saveTasks();
                renderTasks();
                updateCurrentTask();
                updateStats();
            }
        }
        
        // Open task modal for adding or editing
        function openTaskModal(taskId = null) {
            editingTaskId = taskId;
            
            if (taskId) {
                // Editing existing task
                const task = tasks.find(t => t.id === taskId);
                if (task) {
                    taskTitleInput.value = task.title;
                    taskStartInput.value = formatTime(new Date(task.startTime));
                    taskEndInput.value = formatTime(new Date(task.endTime));
                    taskIdInput.value = task.id;
                    modalTitle.textContent = 'Edit Task';
                }
            } else {
                // Adding new task
                taskTitleInput.value = '';
                taskStartInput.value = '';
                taskEndInput.value = '';
                taskIdInput.value = '';
                modalTitle.textContent = 'Add New Task';
            }
            
            taskModal.classList.remove('hidden');
        }
        
        // Close task modal
        function closeTaskModal() {
            taskModal.classList.add('hidden');
            editingTaskId = null;
        }
        
        // Handle task form submission
        function handleTaskFormSubmit(e) {
            e.preventDefault();
            
            const title = taskTitleInput.value.trim();
            const startTime = taskStartInput.value;
            const endTime = taskEndInput.value;
            
            if (!title || !startTime || !endTime) {
                alert('Please fill in all fields');
                return;
            }
            
            // Create date objects for times (using today as the date)
            const now = new Date();
            const startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const [startHours, startMinutes] = startTime.split(':').map(Number);
            startDate.setHours(startHours, startMinutes);
            
            const endDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const [endHours, endMinutes] = endTime.split(':').map(Number);
            endDate.setHours(endHours, endMinutes);
            
            // Validate times
            if (endDate <= startDate) {
                alert('End time must be after start time');
                return;
            }
            
            if (editingTaskId) {
                // Update existing task
                const taskIndex = tasks.findIndex(task => task.id === editingTaskId);
                if (taskIndex !== -1) {
                    tasks[taskIndex] = {
                        ...tasks[taskIndex],
                        title,
                        startTime: startDate.toISOString(),
                        endTime: endDate.toISOString()
                    };
                }
            } else {
                // Add new task
                const newTask = {
                    id: Date.now().toString(),
                    title,
                    startTime: startDate.toISOString(),
                    endTime: endDate.toISOString(),
                    done: false
                };
                
                tasks.push(newTask);
            }
            
            saveTasks();
            renderTasks();
            updateCurrentTask();
            updateStats();
            closeTaskModal();
        }
        
        // Process mass task input
        function processMassTasks() {
            const input = massTaskInput.value.trim();
            if (!input) return;
            
            const lines = input.split('\n');
            let currentDate = null;
            
            for (const line of lines) {
                const trimmedLine = line.trim();
                if (!trimmedLine) continue;
                
                // Check for date line (format: dd/mm/yyyy)
                const dateMatch = trimmedLine.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);
                if (dateMatch) {
                    const day = parseInt(dateMatch[1]);
                    const month = parseInt(dateMatch[2]) - 1; // Months are 0-indexed
                    const year = parseInt(dateMatch[3]);
                    currentDate = new Date(year, month, day);
                    continue;
                }
                
                // Only process if we have a valid date
                if (!currentDate) continue;
                
                // Parse task line (format: 6h30–8h: Task Title)
                const taskMatch = trimmedLine.match(/^(\d{1,2})h(\d{0,2})?–(\d{1,2})h(\d{0,2})?:\s*(.+)$/);
                if (taskMatch) {
                    const startHour = parseInt(taskMatch[1]);
                    const startMinute = taskMatch[2] ? parseInt(taskMatch[2]) : 0;
                    const endHour = parseInt(taskMatch[3]);
                    const endMinute = taskMatch[4] ? parseInt(taskMatch[4]) : 0;
                    const title = taskMatch[5].trim();
                    
                    const startDate = new Date(currentDate);
                    startDate.setHours(startHour, startMinute);
                    
                    const endDate = new Date(currentDate);
                    endDate.setHours(endHour, endMinute);
                    
                    // Add the task
                    tasks.push({
                        id: Date.now().toString() + Math.random().toString(36).substr(2, 5),
                        title,
                        startTime: startDate.toISOString(),
                        endTime: endDate.toISOString(),
                        done: false
                    });
                }
            }
            
            saveTasks();
            renderTasks();
            updateStats();
            massTaskInput.value = '';
            
            // Show success message
            alert(`${tasks.length} tasks added successfully!`);
        }
        
        // Update stats counters
        function updateStats() {
            const total = tasks.length;
            const completed = tasks.filter(task => task.done).length;
            const pending = total - completed;
            
            totalTasksElement.textContent = total;
            completedTasksElement.textContent = completed;
            pendingTasksElement.textContent = pending;
        }
        
        // Save tasks to localStorage
        function saveTasks() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
        }
        
        // Trigger confetti effect
        function triggerConfetti() {
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 }
            });
            
            // Add additional bursts
            setTimeout(() => {
                confetti({
                    particleCount: 100,
                    angle: 60,
                    spread: 55,
                    origin: { x: 0 }
                });
                
                confetti({
                    particleCount: 100,
                    angle: 120,
                    spread: 55,
                    origin: { x: 1 }
                });
            }, 250);
        }
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>